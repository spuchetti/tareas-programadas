name: Ejecutar bot fv-drive-automatico

on:
  workflow_dispatch:
  schedule:
    - cron: "0 10 21 * *"   # Día 21 de cada mes a las 10 UTC (7am Argentina)

jobs:
  run-task:
    runs-on: ubuntu-latest

    env:
      GDRIVE_JSON: ${{ secrets.GDRIVE_JSON }}
      SMTP_TO_FV: ${{ secrets.SMTP_TO_FV }}
      SMTP_FROM: ${{ secrets.SMTP_FROM }}
      SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Mostrar hora actual del servidor
        run: date

      - name: Instalar Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Instalar dependencias
        run: |
          pip install --upgrade pip
          pip install \
            google-api-python-client==2.121.0 \
            google-auth==2.29.0 \
            google-auth-oauthlib==1.2.0 \
            google-auth-httplib2==0.2.0 \
            httplib2==0.22.0 \
            openpyxl==3.1.2

      - name: Ejecutar bot de fondo voluntario
        run: python src/fv_drive_bot.py

      - name: Subir excels generados
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: excels-fv-generados
          path: generados/**/*
          retention-days: 15

      - name: Mostrar finalización
        run: echo "✅ Bot de fondo voluntario ejecutado correctamente."